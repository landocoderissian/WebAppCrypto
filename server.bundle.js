(()=>{var e={268:e=>{"use strict";e.exports=require("body-parser")},577:e=>{"use strict";e.exports=require("cors")},252:e=>{"use strict";e.exports=require("express")},896:e=>{"use strict";e.exports=require("fs")},928:e=>{"use strict";e.exports=require("path")}},r={};function s(t){var o=r[t];if(void 0!==o)return o.exports;var n=r[t]={exports:{}};return e[t](n,n.exports,s),n.exports}var t=s(252),o=s(577),n=s(268),a=s(896),u=s(928),i=t(),c=process.env.PORT||3e3;i.use(o()),i.use((function(e,r,s){r.header("Access-Control-Allow-Origin","*"),r.header("Access-Control-Allow-Headers","Origin, X-Requested-With, Content-Type, Accept"),s()})),i.use(n.json()),i.use(t.static(u.join(__dirname,"public")));var d=u.join(__dirname,"users.json"),p=[{stageNumber:1,story:"Haha! You have been tricked by us, the hackers. To restart the power plant, you must get past the intense security measures set by us to keep you out. These measures can range from easily encrypted codes, to extremely hard maths. \n \n You must figure out the first password by using the intercepted clue that was being communicated by the hackers that you eavesdropped on.",passcode:"Decryption"},{stageNumber:2,story:"Well, wow, I guess you aren’t as bad as I thought at ciphers. Here's a clue: You must look around for a paper, here you will see that 8 is used for the second part. Decode this: 42/34/44/11/44/24/33/22",passcode:"Rotating"},{stageNumber:3,story:"Wow, you're doing pretty good but you probably won’t get past this one. Just look for a note like the one from the first part, and the cipher will be revealed to you. Decode this: vniiolauls",passcode:"villainous"},{stageNumber:4,story:"Alright, you have to stop cracking our codes. How did you even get here that fast! I can’t let you solve this one in time.  Decode this: Lvtlxk",passcode:"Potato"},{stageNumber:5,story:"You got here! Wha-wha-what, impossible, but you'll never be able to make it past the final defense."}];function l(){if(!a.existsSync(d))return[];var e=a.readFileSync(d,"utf8");try{return JSON.parse(e)}catch(e){return console.error("Error parsing users.json:",e),[]}}function h(e){a.writeFileSync(d,JSON.stringify(e,null,2),"utf8")}i.post("/start",(function(e,r){try{var s=e.body.name;if(!s)return r.status(400).send("Name is required");var t=l(),o={name:s,stage:1,messages:[]};t.push(o),h(t),r.send({story:p[0].story})}catch(e){console.error("Error in /start:",e),r.status(500).send("Server error")}})),i.post("/next",(function(e,r){try{var s=e.body,t=s.name,o=s.passcode;if(!t||!o)return r.status(400).send("Name and passcode are required");var n=l(),a=n.find((function(e){return e.name===t}));if(!a)return r.status(404).send("User not found");if(p[a.stage-1].passcode===o){a.stage++,h(n);var u=p[a.stage-1];r.send({success:!0,story:u?u.story:"You have completed all stages!"})}else r.send({success:!1,message:"Incorrect passcode"})}catch(e){console.error("Error in /next:",e),r.status(500).send("Server error")}})),i.get("/users",(function(e,r){try{var s=l();r.send(s)}catch(e){console.error("Error in /users:",e),r.status(500).send("Server error")}})),i.post("/send-message",(function(e,r){try{var s=e.body,t=s.name,o=s.message;if(!t||!o)return r.status(400).send("Name and message are required");var n=l(),a=n.find((function(e){return e.name===t}));if(!a)return r.status(404).send("User not found");a.messages.push(o),h(n),r.send(a)}catch(e){console.error("Error in /send-message:",e),r.status(500).send("Server error")}})),i.post("/kick",(function(e,r){try{var s=e.body.name;if(!s)return r.status(400).send("Name is required");var t=l();h(t=t.filter((function(e){return e.name!==s}))),r.send("User kicked")}catch(e){console.error("Error in /kick:",e),r.status(500).send("Server error")}})),i.get("/get-messages",(function(e,r){try{var s=e.query.name;if(!s)return r.status(400).send("Name is required");var t=l().find((function(e){return e.name===s}));if(!t)return r.status(404).send("User not found");r.send(t.messages)}catch(e){console.error("Error in /get-messages:",e),r.status(500).send("Server error")}})),i.listen(c,(function(){console.log("Server is running on port ".concat(c))}))})();